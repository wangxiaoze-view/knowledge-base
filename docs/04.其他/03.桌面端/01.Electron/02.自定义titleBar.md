---
title: 自定义titleBar
date: 2024-05-10 09:37:44
permalink: /pages/e24bf7/
---

因为`electron`是桌面跨端方案, 所有涉及到不同的操作系统, 但针对于`electron`的`titleBar`的样式, 我们需要根据不同的操作系统进行不同的处理.

可能您比较喜欢`windows`的`titleBar`, 也可能比较喜欢`mac`的`titleBar`, 当然我们可以根据操作系统的判断编写不同的样式

不过我比较喜欢将它们统一处理，那我就比较喜欢`mac`的`titleBar`了, 因为它的配色不再单调统一，颜色搭配也是比较舒服的；但是在`windows`上显示`mac`的`titleBar`虽然好看，但是好像没有遵循`windows`的开发规范了，您可以观察一下`windows`的`titleBar`的关闭按钮都是在右上方的；

我就举例说明一下自定义的`titleBar`如何操作?

::: tip
这篇文章的项目结构是[项目初始化](/pages/0ea9d1)的初始化的项目; 具体的目录机构可以将创建项目自行寻找;
:::

## electron-入口文件修改

首先先需要将默认的`titleBarStyle`进行修改，我们打开`main.js`文件，找到如下代码：

```js
function createWindow(): void {
  onst mainWindow = new BrowserWindow({
    ...
    // 加上这行
    titleBarStyle: 'hiddenInset', 
    ...
  })
}
```

这样重新刷新一下就可以看下，默认的`titleBar`消失不见了；

## 自定义

因为前端是`vue`搭建的，那么直接将这部分作为一个组件拆分出去:

这里将`mac`左上角的操作区域进行演示:

``` html
<div class="custom-titlebar">
  <div class="handler-btn">
    <!-- 关闭按钮 -->
    <div class="handler-btn--icon close-icon">
      <i class="icon-font ri-close-line"></i>
    </div>
    <!-- 最小化按钮 -->
    <div class="handler-btn--icon min-icon">
      <i class="icon-font ri-subtract-line"></i>
    </div>
  </div>
</div>
```

因为`electron`是借住`webview`的`window`对象来控制窗口的，所以需要通过`window.webContents.send`来发送消息给`main.js`，然后`main.js`来控制窗口。

既然是前端的东西，那就直接`css`进行样式修改（这里我是将样式写在了`main.scss`中，所以需要引入`main.scss`）：

``` scss
/* 自定义顶部tab */
.custom-titlebar {
  position: fixed;
  display: flex;
  align-items: center;
  flex-shrink: 0;
  /* 高度与 main.js 中 titleBarOverlay.height 一致  */
  height: 35px;
  width: 100%;
  /* 标题栏始终在最顶层（避免后续被 Modal 之类的覆盖） */
  z-index: 9999;
  background-color: transparent;
  color: white;
  padding-left: 12px;
  font-size: 14px;
  /* 避免选中窗口标题 */
  user-select: none;
  /* 设置该属性表明这是可拖拽区域，用来移动窗口 */
  -webkit-app-region: drag;

  .handler-btn {
    -webkit-app-region: none;
    display: flex;
    align-items: center;

    &--icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 14px;
      height: 14px;
      border-radius: 50px;
      color: #333;
      font-size: 12px;
      cursor: pointer;

      &.close-icon {
        margin-right: 10px;
        background-color: #fe5f57;
        border: 1px solid #e14138;
      }

      &.min-icon {
        background-color: #febc2e;
        border: 1px solid #e09d1f;
      }

      .icon-font {
        opacity: 0;
        transition: opacity cubic-bezier(0.175, 0.885, 0.32, 1.275) 0.5s;
      }
    }
    &:hover .icon-font {
      opacity: 1;
    }
  }
}
```

这样的话`vue`自定义的`titleBar`就写好了, 但是还是缺少相关的`关闭，缩小功能`:

## 操作功能

``` vue
<script lang="ts" setup>
// 窗口缩小/关闭
const handlerIpcWindow = (type: 'window-minimize' | 'window-close') => {
  window.electron.ipcRenderer.send(type)
}
</script>

<template>
  <div class="custom-titlebar">
    <div class="handler-btn">
      <div class="handler-btn--icon close-icon" @click="handlerIpcWindow('window-close')">
        <i class="icon-font ri-close-line"></i>
      </div>
      <div class="handler-btn--icon min-icon" @click="handlerIpcWindow('window-minimize')">
        <i class="icon-font ri-subtract-line"></i>
      </div>
    </div>
  </div>
</template>
```

`window.electron`是从哪里来的?

``` ts

// 目录文件地址： `/src/preload/index.ts`
import { contextBridge } from 'electron'
import { electronAPI } from '@electron-toolkit/preload'

// Custom APIs for renderer
const api = {
}

// Use `contextBridge` APIs to expose Electron APIs to
// renderer only if context isolation is enabled, otherwise
// just add to the DOM global.
if (process.contextIsolated) {
  try {
    contextBridge.exposeInMainWorld('electron', electronAPI)
    contextBridge.exposeInMainWorld('api', api)
  } catch (error) {
    console.error('ap:====>', error)
  }
} else {
  // @ts-ignore (define in dts)
  // window.electron 是在这里挂载的
  window.electron = electronAPI
  // @ts-ignore (define in dts)
  window.api = api
}
```

既然找到了`window.electron`, 那么就需要和`electron`进行通信了;

``` js
const handlerIpcWindow = (type: 'window-minimize' | 'window-close') => {
  window.electron.ipcRenderer.send(type)
}
```

## 通信

首先创建文件`/src.main/ipc/index.ts`, 代码如下:

``` ts
import { IpcMain } from 'electron'

// web向electron主线程传递消息
export function ipcMainFun(ipcMain: IpcMain) {
  // 窗口最小化
  ipcMain.on('window-minimize', () => {
    BrowserWindow.getFocusedWindow()?.minimize()
  })
  // 窗口关闭
  ipcMain.on('window-close', () => {
    BrowserWindow.getFocusedWindow()?.close()
  })
}
```

这样的主体函数就完成了；但是还不能使用, 因为你还没有在入口文件中引入;

``` ts
// 引入刚刚写好的主体函数
import { ipcMainFun } from './ipc'
app.whenReady().then(() => {
  // IPC 注册
  ipcMainFun(ipcMain)
})
```

这样的话就可以使用了;
